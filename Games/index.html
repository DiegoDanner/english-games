<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acesso aos Quizzes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <!-- Seção de Login (Visível por padrão) -->
    <div id="login-section" class="w-full max-w-sm p-8 bg-white rounded-2xl shadow-lg text-center">
        <img src="https://danneridiomas.netlify.app/images/colorido.png" alt="Logo Danner Idiomas" class="mx-auto mb-4 w-32">
        <h1 class="text-2xl font-bold text-gray-800 mb-2">Bem-vindo!</h1>
        <p class="text-gray-600 mb-6">Faça login com sua conta Google para acessar os quizzes.</p>
        <button id="login-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 shadow-md flex items-center justify-center">
            <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Entrar com Google
        </button>
        <p id="auth-error" class="mt-4 text-sm text-red-500"></p> <!-- Mensagens de erro -->
    </div>

    <!-- Seção de Conteúdo (Oculta por padrão) -->
    <div id="content-section" class="hidden w-full max-w-4xl p-8 bg-white rounded-2xl shadow-lg">
        <div class="flex justify-between items-center border-b pb-4 mb-6">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">Lista de Quizzes</h1>
                <p id="user-display" class="text-gray-600">Logado como: <span class="font-semibold"></span></p>
            </div>
            <button id="logout-button" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200">
                Logout
            </button>
        </div>

        <!-- Lista de Jogos -->
        <div id="game-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
            <!-- Os links dos jogos serão inseridos aqui -->
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import {
            getAuth,
            onAuthStateChanged,
            GoogleAuthProvider,
            signInWithPopup,
            signOut,
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import {
            getFirestore,
            doc,
            setDoc,
            collection,
            addDoc,
            serverTimestamp,
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        // --- CONFIGURAÇÃO DO FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDJe81bxA-PKG7q_ouT7MWIe6Od5QwS0VQ",
            authDomain: "app-gestao-alunos.firebaseapp.com",
            projectId: "app-gestao-alunos",
            storageBucket: "app-gestao-alunos.firebasestorage.app",
            messagingSenderId: "501391699545",
            appId: "1:501391699545:web:c8c581f65d5116d7424b48",
            measurementId: "G-Q8J6YZWNFZ",
        };

        // --- INICIALIZAÇÃO ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- ELEMENTOS DA UI ---
        const loginSection = document.getElementById('login-section');
        const contentSection = document.getElementById('content-section');
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const userDisplay = document.getElementById('user-display').querySelector('span');
        const authError = document.getElementById('auth-error');

        // --- LÓGICA DE AUTENTICAÇÃO ---

        // Monitora mudanças no estado de autenticação
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usuário está logado
                showContent(user);
            } else {
                // Usuário não está logado
                showLogin();
            }
        });

        // Função de Login
        loginButton.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            try {
                const result = await signInWithPopup(auth, provider);
                await recordAccess(result.user);
                // O onAuthStateChanged vai cuidar de mostrar o conteúdo
            } catch (error) {
                console.error("Erro no login com Google:", error);
                authError.textContent = `Falha no login: ${error.code}`;
            }
        });

        // --- FUNÇÕES DO FIRESTORE ---
        async function recordAccess(user) {
            try {
                await addDoc(collection(db, "acessos_index"), {
                    nome: user.displayName,
                    email: user.email,
                    data: serverTimestamp(),
                });
            } catch (e) {
                console.error("Erro ao registrar acesso: ", e);
            }
        }

        // Função de Logout
        logoutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
                // O onAuthStateChanged vai cuidar de mostrar a tela de login
            } catch (error) {
                console.error("Erro ao fazer logout:", error);
            }
        });

        // --- CONTROLE DA UI ---
        function showLogin() {
            loginSection.classList.remove('hidden');
            contentSection.classList.add('hidden');
        }

        function showContent(user) {
            loginSection.classList.add('hidden');
            contentSection.classList.remove('hidden');
            userDisplay.textContent = user.displayName || user.email;
            renderGameList(); // <-- Adicionado aqui
        }

        // --- RENDERIZAÇÃO DA LISTA DE JOGOS ---
        function renderGameList() {
            const gameListContainer = document.getElementById('game-list');
            const games = [
                { name: "Memory Match", url: "memory-match.html" },
                { name: "Comparative & Superlative", url: "comparative-superlative.html" },
                { name: "Verb 'to be' Quiz", url: "verbtobe-quiz.html" },
                { name: "Object Pronoun Quiz", url: "objectPronoun-quiz.html" },
                { name: "General English Quiz", url: "quiz-english.html" },
                { name: "Superlative & Comparative II", url: "quiz-super-comp.html" },
                { name: "Class Control", url: "class-control.html" },
                { name: "Gestão de Alunos", url: "gestao_alunos.html" },
                { name: "Máquina HTB", url: "maquinaHtb (3).html" },
                { name: "Questions to Practice", url: "questionstopracticeenglish.html" },
                { name: "Pronomes (IA)", url: "quiz-pronomes-AI.html" },
            ];

            gameListContainer.innerHTML = games.map(game => `
                <a href="${game.url}" class="block bg-gray-50 hover:bg-indigo-50 p-6 rounded-lg shadow-md transition duration-200">
                    <h3 class="text-lg font-semibold text-gray-800">${game.name}</h3>
                </a>
            `).join('');
        }
    </script>

</body>
</html>
