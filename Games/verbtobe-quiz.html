<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Interativo: Verbo "To Be"</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div id="header-placeholder"></div>

    <div class="quiz-container">
      <div style="text-align: center; margin-bottom: 2rem">
        <h1>Quiz: O Verbo "To Be"</h1>
        <p style="margin-top: 0.5rem">
          üî§ Complete one conversation at a time.
        </p>
      </div>

      <div id="quiz-content">
        <div class="quiz-step" data-step="0">
          <div class="conversation-box">
            <p class="conversation-title">1. Conversation at the Cafe</p>
            <div class="dialogue">
              <p>
                A:
                <span class="quiz-item"
                  ><select data-answer="Are" class="quiz-select">
                    <option value="">...</option
                    ><option value="am">am</option
                    ><option value="is">is</option
                    ><option value="are">are</option
                    ><option value="'m">'m</option
                    ><option value="'s">'s</option
                    ><option value="'re">'re</option></select
                  ></span
                >
                you from Canada?
              </p>
              <p>
                B: No, I
                <span class="quiz-item"
                  ><select data-answer="'m,am" class="quiz-select">
                    <option value="">...</option
                    ><option value="am">am</option
                    ><option value="is">is</option
                    ><option value="are">are</option
                    ><option value="'m">'m</option
                    ><option value="'s">'s</option
                    ><option value="'re">'re</option></select
                  ></span
                >
                not. I
                <span class="quiz-item"
                  ><select data-answer="am,'m" class="quiz-select">
                    <option value="">...</option
                    ><option value="am">am</option
                    ><option value="is">is</option
                    ><option value="are">are</option
                    ><option value="'m">'m</option
                    ><option value="'s">'s</option
                    ><option value="'re">'re</option></select
                  ></span
                >
                from Ireland.
              </p>
              <p>
                A: Oh, that
                <span class="quiz-item"
                  ><select data-answer="'s,is" class="quiz-select">
                    <option value="">...</option
                    ><option value="am">am</option
                    ><option value="is">is</option
                    ><option value="are">are</option
                    ><option value="'m">'m</option
                    ><option value="'s">'s</option
                    ><option value="'re">'re</option></select
                  ></span
                >
                interesting!
              </p>
            </div>
          </div>
          <div class="step-controls">
            <button class="check-step-btn btn">Check Answer</button>
            <button class="next-step-btn btn hidden">Next</button>
          </div>
        </div>

        <div class="quiz-step hidden" data-step="1">
          <div class="conversation-box">
            <p class="conversation-title">2. Weekend Plans</p>
            <div class="dialogue">
              <p>
                A: Where
                <span class="quiz-item"
                  ><select data-answer="are" class="quiz-select">
                    <option value="">...</option
                    ><option value="am">am</option
                    ><option value="is">is</option
                    ><option value="are">are</option
                    ><option value="'m">'m</option
                    ><option value="'s">'s</option
                    ><option value="'re">'re</option></select
                  ></span
                >
                your brother and sister?
              </p>
              <p>
                B: They
                <span class="quiz-item"
                  ><select data-answer="'re,are" class="quiz-select">
                    <option value="">...</option
                    ><option value="am">am</option
                    ><option value="is">is</option
                    ><option value="are">are</option
                    ><option value="'m">'m</option
                    ><option value="'s">'s</option
                    ><option value="'re">'re</option></select
                  ></span
                >
                at the park.
              </p>
              <p>A: What about your mom?</p>
              <p>
                B: She
                <span class="quiz-item"
                  ><select data-answer="'s,is" class="quiz-select">
                    <option value="">...</option
                    ><option value="am">am</option
                    ><option value="is">is</option
                    ><option value="are">are</option
                    ><option value="'m">'m</option
                    ><option value="'s">'s</option
                    ><option value="'re">'re</option></select
                  ></span
                >
                at home. I think she
                <span class="quiz-item"
                  ><select data-answer="is,'s" class="quiz-select">
                    <option value="">...</option
                    ><option value="am">am</option
                    ><option value="is">is</option
                    ><option value="are">are</option
                    ><option value="'m">'m</option
                    ><option value="'s">'s</option
                    ><option value="'re">'re</option></select
                  ></span
                >
                cooking lunch.
              </p>
            </div>
          </div>
          <div class="step-controls">
            <button class="check-step-btn btn">Check Answer</button>
            <button class="next-step-btn btn hidden">Next</button>
          </div>
        </div>

        <div id="results-screen" class="quiz-step hidden" data-step="2">
          <h2>Quiz Complete!</h2>
          <p id="final-score"></p>
          <p id="final-message"></p>
          <button id="retry-btn" class="btn">Tentar Novamente</button>
        </div>
      </div>
    </div>

    <script src="js/main.js"></script>
    <script type="module" src="js/header.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const quizContent = document.getElementById("quiz-content");
        const steps = document.querySelectorAll(".quiz-step");
        const totalCorrectAnswers = document.querySelectorAll(".quiz-item").length;
        let currentStep = 0;
        let score = 0;

        quizContent.addEventListener("click", (e) => {
          if (e.target.classList.contains("check-step-btn")) {
            handleCheckStep(e.target);
          }
          if (e.target.classList.contains("next-step-btn")) {
            goToNextStep();
          }
        });

        document.getElementById("retry-btn").addEventListener("click", () => {
          window.location.reload();
        });

        function handleCheckStep(checkButton) {
          const stepElement = checkButton.closest(".quiz-step");
          const itemsInStep = stepElement.querySelectorAll(".quiz-item");
          itemsInStep.forEach((item) => {
            const select = item.querySelector("select");
            if (select) {
              const userAnswer = select.value;
              const correctAnswers = select.dataset.answer.toLowerCase().split(",");
              const primaryCorrectAnswer = select.dataset.answer.split(",")[0];
              let feedbackHTML = "";
              if (correctAnswers.includes(userAnswer.toLowerCase())) {
                score++;
                feedbackHTML = `<span class="feedback-correct">${userAnswer} ‚úîÔ∏è</span>`;
              } else {
                const displayAnswer = userAnswer || "...";
                feedbackHTML = `<span class="feedback-incorrect">${displayAnswer} ‚ùå</span> <span class="correct-answer-text">(${primaryCorrectAnswer})</span>`;
              }
              item.innerHTML = feedbackHTML;
            }
          });
          const nextButton = stepElement.querySelector(".next-step-btn");
          checkButton.classList.add("hidden");
          nextButton.classList.remove("hidden");
        }

        function goToNextStep() {
          steps[currentStep].classList.add("hidden");
          currentStep++;
          if (currentStep < steps.length - 1) {
            steps[currentStep].classList.remove("hidden");
          } else {
            showFinalResults();
          }
        }

        function showFinalResults() {
          const resultsScreen = document.getElementById("results-screen");
          const finalScoreEl = document.getElementById("final-score");
          const finalMessageEl = document.getElementById("final-message");

          // Hide the last quiz step before showing results
          if (steps[currentStep]) {
            steps[currentStep].classList.add("hidden");
          } else if(steps[currentStep-1]) {
             steps[currentStep-1].classList.add("hidden");
          }

          finalScoreEl.textContent = `Your final score: ${score} out of ${totalCorrectAnswers}`;
          let message = "";
          if (score === totalCorrectAnswers) {
            message = "üéâ Excellent! You got everything right!";
          } else if (score > totalCorrectAnswers / 2) {
            message = "üëç Good job! Keep practicing.";
          } else {
            message = "ü§î Keep trying! Practice makes perfect.";
          }
          finalMessageEl.textContent = message;
          resultsScreen.classList.remove("hidden");
        }
      });
    </script>
  </body>
</html>
