<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Pronomes com IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/style.css" />
</head>
<body class="flex items-center justify-center min-h-screen">
    <header class="page-header">
        <img src="img/logo.svg" alt="logo" class="logo">
        <a
          href="https://game-quizzes.netlify.app/"
          class="menu-link"
          title="Back to Home"
          >Menu</a
        >
        <button id="theme-toggle-btn">üåû</button>
      </header>
    <div id="quiz" class="quiz-container p-6 sm:p-8 rounded-xl">
        
        <!-- Tela de In√≠cio -->
        <div id="welcome-screen" class="text-center">
            <h1 class="text-3xl font-bold mb-2">Object Pronouns</h1>
            <p class="mb-6">"Object pronouns" s√£o pequenas palavras que substituem nomes para evitar repeti√ß√£o.</p>
            <div class="text-left my-6 space-y-2">
                <p class="flex items-center"><span class="flex-shrink-0 w-5 h-5 mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" /></svg></span>Subject Pronouns s√£o aqueles que fazem a a√ß√£o na frase.</p>
                <p class="flex items-center"><span class="flex-shrink-0 w-5 h-5 mr-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" /></svg></span>Object Pronouns s√£o aqueles que recebem a a√ß√£o na frase.</p>
            </div>
            <div class="w-full overflow-hidden rounded-lg shadow-md my-8">
                <table class="pronoun-table w-full text-sm text-left">
                    <thead>
                        <tr>
                            <th scope="col" class="px-6 py-3">Subject Pronoun (pronome pessoal)</th>
                            <th scope="col" class="px-6 py-3">Object Pronoun (pronome obl√≠quo)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td class="px-6 py-4">I</td><td class="px-6 py-4">me</td></tr>
                        <tr><td class="px-6 py-4">you</td><td class="px-6 py-4">you</td></tr>
                        <tr><td class="px-6 py-4">he</td><td class="px-6 py-4">him</td></tr>
                        <tr><td class="px-6 py-4">she</td><td class="px-6 py-4">her</td></tr>
                        <tr><td class="px-6 py-4">it</td><td class="px-6 py-4">it</td></tr>
                        <tr><td class="px-6 py-4">we</td><td class="px-6 py-4">us</td></tr>
                        <tr><td class="px-6 py-4">you</td><td class="px-6 py-4">you</td></tr>
                        <tr><td class="px-6 py-4">they</td><td class="px-6 py-4">them</td></tr>
                    </tbody>
                </table>
            </div>
            <button id="start-quiz-btn" class="w-full px-6 py-3 font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105">Come√ßar o Quiz!</button>
        </div>

        <!-- Sele√ß√£o de Modo -->
        <div id="mode-selection" class="hidden text-center">
            <h1 class="text-2xl font-bold mb-4">Quiz de Pronomes</h1>
            <p class="mb-8">Escolha um modo para come√ßar.</p>
            <div class="flex flex-col sm:flex-row gap-4">
                <button id="standard-quiz-btn" class="w-full px-6 py-3 font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105">Quiz Padr√£o (10 Quest√µes)</button>
                <button id="gemini-practice-btn" class="w-full px-6 py-3 font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105 gemini-btn">‚ú® Pr√°tica com IA</button>
            </div>
        </div>

        <!-- Estrutura do Quiz (inicialmente escondida) -->
        <div id="quiz-structure" class="hidden">
            <!-- Header do Quiz -->
            <div id="header-container" class="flex justify-between items-center mb-6">
                <h1 id="quiz-title" class="text-xl sm:text-2xl font-bold"></h1>
                <button id="back-to-menu" class="text-sm font-semibold back-menu-btn">Menu</button>
            </div>
            
            <div id="progress-container">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium">Progresso</span>
                    <span id="progress-text" class="text-sm font-semibold">Quest√£o 1 de 10</span>
                </div>
                <div class="progress-bar-bg w-full rounded-full h-2.5 mb-6">
                    <div id="progress-bar" class="progress-bar h-2.5 rounded-full" style="width: 10%"></div>
                </div>
            </div>

            <!-- Container da Quest√£o -->
            <div id="question-container" class="mb-6 min-h-[150px] flex items-center justify-center">
                <p id="question-text" class="text-lg sm:text-xl leading-relaxed text-center"></p>
                <div id="loader" class="loader hidden"></div>
            </div>
            <div id="feedback" class="mt-4 p-4 rounded-lg text-sm hidden"></div>
            
            <!-- Bot√µes de Navega√ß√£o -->
            <div id="navigation-container" class="flex flex-col sm:flex-row gap-4 items-center justify-between">
                <button id="check-btn" class="w-full sm:w-auto px-6 py-2 font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105">Verificar</button>
                <button id="next-btn" class="hidden w-full sm:w-auto px-6 py-2 font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105 next-btn">Pr√≥xima</button>
                <button id="gemini-generate-btn" class="hidden w-full sm:w-auto px-6 py-2 font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105 gemini-btn">‚ú® Gerar Nova Frase</button>
            </div>

            <!-- Tela de Resultados -->
            <div id="results-container" class="hidden text-center">
                <h2 class="text-2xl font-bold mb-4">Quiz Conclu√≠do!</h2>
                <p class="text-lg mb-2">Sua pontua√ß√£o final √©:</p>
                <p id="score" class="text-4xl font-bold score-text mb-6"></p>
                <button id="restart-btn" class="px-8 py-3 font-semibold rounded-lg shadow-md transition-transform transform hover:scale-105">Refazer Quiz</button>
            </div>
        </div>
    </div>

    <script>
        // --- DADOS E VARI√ÅVEIS GLOBAIS ---
        const staticQuizData = [
            { question: "I can't find my keys. ‚áí I can't find&nbsp;{input}.", answers: ["them"], explanation: "<strong>Keys</strong> √© plural. Para coisas, usamos <strong>it/it</strong> no singular e <strong>they/them</strong> no plural. Keys = they/them." },
            { question: "Rachel helps the students. ‚áí&nbsp;{input}&nbsp;helps&nbsp;{input}.", answers: ["she", "them"], explanation: "Usamos pronomes sujeito (she) <strong>antes</strong> do verbo (helps). Usamos pronomes objeto (them) <strong>depois</strong> do verbo (helps)." },
            { question: "I need to tell John the truth. ‚áí I need to tell&nbsp;{input}&nbsp;the truth.", answers: ["him"], explanation: "John = he/him. Usamos pronomes objeto (him) <strong>depois</strong> do verbo (tell)." },
            { question: "My dad and I love chocolate. ‚áí&nbsp;{input}&nbsp;love&nbsp;{input}.", answers: ["we", "it"], explanation: "Usamos pronomes sujeito (we) <strong>antes</strong> do verbo (love). Usamos pronomes objeto (it) <strong>depois</strong> do verbo (love). Chocolate = it." },
            { question: "Suzan and Tom call their daughter every day. ‚áí&nbsp;{input}&nbsp;call&nbsp;{input}&nbsp;every day.", answers: ["they", "her"], explanation: "Suzan and Tom = they/them. Their daughter = she/her. Usamos pronomes sujeito (They) <strong>antes</strong> do verbo (call) e pronomes objeto (her) <strong>depois</strong> do verbo." },
            { question: "I like cooking for my children. ‚áí I like cooking for&nbsp;{input}.", answers: ["them"], explanation: "My children = they/them. Usamos pronomes objeto (them) <strong>depois</strong> de preposi√ß√µes (for)." },
            { question: "Give the documents to Carmen. ‚áí Give&nbsp;{input}&nbsp;to&nbsp;{input}.", answers: ["them", "her"], explanation: "Usamos pronomes objeto (them) <strong>depois</strong> do verbo (give) e (her) <strong>depois</strong> da preposi√ß√£o (to). <strong>Documents</strong> √© plural, ent√£o usamos they/them." },
            { question: "Tom often plays football with my friends and me. ‚áí&nbsp;{input}&nbsp;often plays football with&nbsp;{input}.", answers: ["he", "us"], explanation: "Tom = he/him. My friends and me = us. Usamos pronomes sujeito (He) <strong>antes</strong> do verbo (plays) e pronomes objeto (us) <strong>depois</strong> da preposi√ß√£o (with)." },
            { question: "How old is Emma? ‚áí How old is&nbsp;{input}?", answers: ["she"], explanation: "Emma = she/her. Precisamos de um pronome sujeito porque em perguntas, o sujeito vai <strong>depois</strong> do verbo 'be'." },
            { question: "I need the scissors to cut the paper. ‚áí I need&nbsp;{input}&nbsp;to cut&nbsp;{input}.", answers: ["them", "it"], explanation: "<strong>Scissors</strong> √© plural (they/them). <strong>Paper</strong> √© singular (it). Usamos pronomes objeto <strong>depois</strong> dos verbos (need, cut)." }
        ];
        
        let currentQuizData = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let quizMode = ''; // 'standard' ou 'gemini'
        let currentDynamicQuestion = null;

        // --- ELEMENTOS DO DOM ---
        const welcomeScreenEl = document.getElementById('welcome-screen');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const modeSelectionEl = document.getElementById('mode-selection');
        const quizStructureEl = document.getElementById('quiz-structure');
        const standardQuizBtn = document.getElementById('standard-quiz-btn');
        const geminiPracticeBtn = document.getElementById('gemini-practice-btn');
        const backToMenuBtn = document.getElementById('back-to-menu');
        const quizTitleEl = document.getElementById('quiz-title');
        const headerContainer = document.getElementById('header-container');
        const progressContainer = document.getElementById('progress-container');
        const questionContainer = document.getElementById('question-container');
        const navigationContainer = document.getElementById('navigation-container');
        const questionTextEl = document.getElementById('question-text');
        const feedbackEl = document.getElementById('feedback');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const geminiGenerateBtn = document.getElementById('gemini-generate-btn');
        const restartBtn = document.getElementById('restart-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const resultsContainer = document.getElementById('results-container');
        const scoreEl = document.getElementById('score');
        const loader = document.getElementById('loader');

        // --- L√ìGICA DO QUIZ ---
        function startQuiz(mode) {
            quizMode = mode;
            currentQuestionIndex = 0;
            score = 0;
            modeSelectionEl.classList.add('hidden');
            quizStructureEl.classList.remove('hidden');
            
            headerContainer.classList.remove('hidden');
            navigationContainer.classList.remove('hidden');
            questionContainer.classList.remove('hidden');
            resultsContainer.classList.add('hidden');
            
            if (mode === 'standard') {
                quizTitleEl.textContent = 'Quiz Padr√£o';
                currentQuizData = [...staticQuizData];
                progressContainer.classList.remove('hidden');
                geminiGenerateBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
                loadQuestion();
            } else if (mode === 'gemini') {
                quizTitleEl.textContent = 'Pr√°tica com IA';
                progressContainer.classList.add('hidden');
                checkBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden');
                geminiGenerateBtn.classList.remove('hidden');
                generateNewGeminiQuestion();
            }
        }

        function loadQuestion() {
            resetQuestionUI();
            const questionData = currentQuizData[currentQuestionIndex];
            displayQuestion(questionData);
            updateProgress();
        }

        function displayQuestion(questionData) {
            let questionHTML = questionData.question;
            const inputsCount = (questionHTML.match(/{input}/g) || []).length;
            for (let i = 0; i < inputsCount; i++) {
                questionHTML = questionHTML.replace('{input}', `<input type="text" id="answer${i}" class="input-blank" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">`);
            }
            questionTextEl.innerHTML = questionHTML;
            document.getElementById('answer0')?.focus();
        }

        function resetQuestionUI() {
            feedbackEl.classList.add('hidden');
            checkBtn.classList.remove('hidden');
            checkBtn.disabled = false;
            nextBtn.classList.add('hidden');
            questionTextEl.classList.remove('hidden');
            loader.classList.add('hidden');
        }

        function updateProgress() {
            progressText.innerText = `Quest√£o ${currentQuestionIndex + 1} de ${currentQuizData.length}`;
            const progressPercentage = ((currentQuestionIndex + 1) / currentQuizData.length) * 100;
            progressBar.style.width = `${progressPercentage}%`;
        }

        function checkAnswer() {
            const questionData = (quizMode === 'standard') ? currentQuizData[currentQuestionIndex] : currentDynamicQuestion;
            if (!questionData) return;

            let isCorrect = true;
            for (let i = 0; i < questionData.answers.length; i++) {
                const inputEl = document.getElementById(`answer${i}`);
                if (!inputEl) continue;
                const userAnswer = inputEl.value.trim().toLowerCase();
                const correctAnswer = questionData.answers[i].toLowerCase();
                
                if (userAnswer === correctAnswer) {
                    inputEl.style.borderColor = '#22c55e';
                } else {
                    inputEl.style.borderColor = '#ef4444';
                    isCorrect = false;
                }
                inputEl.disabled = true;
            }

            if (isCorrect) {
                score++;
                feedbackEl.classList.remove('bg-red-100', 'text-red-700');
                feedbackEl.classList.add('bg-green-100', 'text-green-700');
                feedbackEl.innerHTML = `<strong>Correto!</strong><br>${questionData.explanation}`;
            } else {
                feedbackEl.classList.remove('bg-green-100', 'text-green-700');
                feedbackEl.classList.add('bg-red-100', 'text-red-700');
                const correctAnswersText = questionData.answers.join(' / ');
                feedbackEl.innerHTML = `<strong>Incorreto.</strong> Resposta correta: <strong>${correctAnswersText}</strong><br>${questionData.explanation}`;
            }

            feedbackEl.classList.remove('hidden');
            checkBtn.classList.add('hidden');
            if (quizMode === 'standard') {
                nextBtn.classList.remove('hidden');
                if (currentQuestionIndex === currentQuizData.length - 1) {
                    nextBtn.textContent = 'Ver Resultados';
                } else {
                    nextBtn.textContent = 'Pr√≥xima';
                }
                nextBtn.focus();
            } else {
                geminiGenerateBtn.classList.remove('hidden');
                geminiGenerateBtn.focus();
            }
        }

        function showResults() {
            headerContainer.classList.add('hidden');
            progressContainer.classList.add('hidden');
            questionContainer.classList.add('hidden');
            navigationContainer.classList.add('hidden');
            
            resultsContainer.classList.remove('hidden');
            scoreEl.innerText = `${score} / ${currentQuizData.length}`;
        }
        
        function backToMenu() {
            quizStructureEl.classList.add('hidden');
            modeSelectionEl.classList.remove('hidden');
        }

        // --- L√ìGICA DA API GEMINI ---
        async function generateNewGeminiQuestion() {
            resetQuestionUI();
            questionTextEl.classList.add('hidden');
            loader.classList.remove('hidden');
            checkBtn.disabled = true;
            geminiGenerateBtn.disabled = true;

            const prompt = `Crie uma quest√£o de quiz em ingl√™s para testar o conhecimento sobre pronomes de sujeito (subject pronouns) e objeto (object pronouns). A frase deve ter um ou dois espa√ßos em branco, representados por "{input}". Forne√ßa a resposta correta e uma explica√ß√£o concisa em portugu√™s. A explica√ß√£o deve ser simples e direta. Retorne o resultado num formato JSON. Exemplo de frase: "Sarah gave {input} a book, and {input} loved it."`;

            const schema = {
                type: "OBJECT",
                properties: {
                    question: { type: "STRING" },
                    answers: { type: "ARRAY", items: { type: "STRING" } },
                    explanation: { type: "STRING" }
                },
                required: ["question", "answers", "explanation"]
            };

            try {
                const result = await callGemini(prompt, schema);
                currentDynamicQuestion = result;
                displayQuestion(result);
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                questionTextEl.innerHTML = "Ocorreu um erro ao gerar a quest√£o. Por favor, tente novamente.";
            } finally {
                questionTextEl.classList.remove('hidden');
                loader.classList.add('hidden');
                checkBtn.disabled = false;
                geminiGenerateBtn.disabled = false;
            }
        }
        
        async function callGemini(prompt, schema) {
            const apiKey = "YOUR_API_KEY"; // SUBSTITUA PELA SUA CHAVE DE API
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: schema,
                    temperature: 1.0,
                }
            };
            
            let response;
            let retries = 3;
            let delay = 1000;
            while (retries > 0) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                            return JSON.parse(result.candidates[0].content.parts[0].text);
                        }
                    }
                } catch (error) {
                    console.log(`Retrying... attempts left: ${retries - 1}`);
                }
                retries--;
                await new Promise(res => setTimeout(res, delay));
                delay *= 2;
            }
            throw new Error("Falha ao comunicar com a API da Gemini ap√≥s v√°rias tentativas.");
        }


        // --- EVENT LISTENERS ---
        startQuizBtn.addEventListener('click', () => {
            welcomeScreenEl.classList.add('hidden');
            modeSelectionEl.classList.remove('hidden');
        });
        standardQuizBtn.addEventListener('click', () => startQuiz('standard'));
        geminiPracticeBtn.addEventListener('click', () => startQuiz('gemini'));
        backToMenuBtn.addEventListener('click', backToMenu);
        geminiGenerateBtn.addEventListener('click', generateNewGeminiQuestion);

        checkBtn.addEventListener('click', checkAnswer);
        
        nextBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            if (currentQuestionIndex < currentQuizData.length) {
                loadQuestion();
            } else {
                showResults();
            }
        });

        restartBtn.addEventListener('click', () => {
            // Ao reiniciar, o texto do bot√£o ser√° resetado pela l√≥gica dentro de checkAnswer
            startQuiz('standard');
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                // Previne o comportamento padr√£o para evitar duplo clique
                e.preventDefault(); 
                
                // A√ß√£o manual baseada no bot√£o vis√≠vel
                if (!checkBtn.classList.contains('hidden') && !checkBtn.disabled) {
                    checkBtn.click();
                } else if (!nextBtn.classList.contains('hidden')) {
                    nextBtn.click();
                }
            }
        });

    </script>
    <script src="js/main.js"></script>
</body>
</html>
